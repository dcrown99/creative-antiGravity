version: '3.8'

services:
  market-watcher:
    container_name: market-watcher
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8001:8000"
    env_file:
      - .env
    environment:
      # MoneyMasterのDBファイル(SQLite)を読み込む設定
      - PORTFOLIO_DB_PATH=/data/dev.db
      # 同一Compose内のVoicevoxへアクセス
      - VOICEVOX_URL=http://voicevox:50021
    volumes:
      - ./:/app
      # 重要: MoneyMasterのPrismaフォルダを読み取り専用でマウント
      # 相対パス: market-watcherフォルダ -> apps -> money-master -> prisma
      - ../money-master/prisma:/data:ro
    depends_on:
      - voicevox
    restart: always

  # [RESTORED] AI Voice Engine
  voicevox:
    image: voicevox/voicevox_engine:cpu-ubuntu20.04-latest
    container_name: voicevox
    ports:
      - "50021:50021"
    restart: unless-stopped
